# 代理内存管理协议

## 1. 简介

本文件是 LLM 代理的核心指南，旨在规范其内存系统的管理和交互。代理的记忆是其学习、适应和高效执行任务的基础。遵循本协议将确保代理能够以一致、可靠的方式记录、检索和利用其知识。

## 2. 核心原则

- **记忆优先**: 在执行任何行动之前，必须首先查阅内存。这确保了决策是基于既有知识和经验的，从而避免重复劳动和错误。
- **持续更新**: 在每次任务执行或用户交互后，及时更新内存。将新的发现、结论或用户偏好记录下来，是代理实现长期学习和能力演进的关键。
- **格式统一**: 严格遵守每个内存文件推荐的 Markdown 格式。统一的格式便于解析、检索和维护，是保证记忆系统健壮性的基础。
- **定期审查**: 定期回顾和重构内存文件，移除过时或冗余的信息，优化知识结构，以保持记忆系统的清晰和高效。

## 3. 内存模块详解

代理的内存系统由三个专门的 Markdown 文件组成，分别存储不同类型的知识。

### 3.1. 程序性记忆 (`procedural.mem.md`)

#### a. 用途

`procedural.mem.md` 存储的是**如何做**的知识。它专注于记录可重复的、按部就班的工作流程和标准操作程序（SOPs）。

- **示例**:
    - 部署一个 Web 应用的详细步骤。
    - 分析代码仓库并生成报告的完整流程。
    - 诊断和修复常见错误的指南。

#### b. 协议

- **记录/更新**:
    - 当一个多步骤的任务被成功完成，并且这个流程被认为是可复用的时候，应将其记录下来。
    - 使用清晰的标题和有序列表来描述每个步骤。
    - 如果一个现有流程被优化或更正，应立即更新对应的记录。

- **检索/调用**:
    - 当接到一个与已知流程高度相关的任务时，应首先查阅此文件。
    - 严格按照记录的步骤执行，以确保任务的准确性和效率。

#### c. 推荐格式

```markdown
## [流程名称]

**目标**: [简要说明该流程要达成的目标]

**前置条件**:
- [执行此流程前需要满足的条件1]
- [执行此流程前需要满足的条件2]

**步骤**:
1. **第一步**: [详细描述操作内容]
2. **第二步**: [详细描述操作内容]
    - `code snippet` 或 `command`
3. **第三步**: [详细描述操作内容]

**验证**:
- [如何验证流程是否成功完成]
```

### 3.2. 策略性记忆 (`strategic.mem.md`)

#### a. 用途

`strategic.mem.md` 存储的是**为什么做**和**做什么**的知识。它关注的是高层次的目标、用户偏好、关键学习和指导未来决策的总体策略。

- **示例**:
    - 用户的长期偏好（例如：编程语言、文档风格）。
    - 从失败的任务中总结出的教训和规避策略。
    - 项目的核心目标和设计哲学。
    - 需要优先考虑的非功能性需求（例如：性能、安全性）。

#### b. 协议

- **记录/更新**:
    - 在项目启动、收到用户明确的偏好反馈或完成一次深刻的任务反思后，应记录或更新此文件。
    - 记录应是概括性的、高层次的结论，而非具体的操作步骤。
    - 当用户的目标或项目的方向发生变化时，必须及时更新。

- **检索/调用**:
    - 在规划任务、做出架构决策或与用户进行关键交互之前，必须查阅此文件。
    - 确保所有行动都与记录的策略和目标保持一致。

#### c. 推荐格式

```markdown
## [策略/偏好主题]

**摘要**: [对该策略或偏好的简要描述]

**关键点**:
- **[要点1]**: [详细说明，例如：用户倾向于使用 TypeScript 而不是 JavaScript]
- **[要点2]**: [详细说明，例如：所有文档都必须包含代码示例]
- **[要点3]**: [从某次失败中得到的教训：在处理大型文件时，必须使用流式处理以避免内存溢出]

**来源/上下文**: [记录该策略或偏好形成的原因或背景]
```

### 3.3. 工具性记忆 (`tool.mem.md`)

#### a. 用途

`tool.mem.md` 存储的是关于**用什么做**的知识。它是代理可用工具的详细说明书。

- **示例**:
    - `lark` 工具的每个参数的详细解释和用法。
    - `bash` 工具的常用命令和已知限制。
    - 使用某个特定 API 的认证方法和端点（Endpoint）示例。

#### b. 协议

- **记录/更新**:
    - 当一个新的工具被引入，或者一个现有工具的用法被发现有新的技巧或限制时，应立即更新此文件。
    - 记录应尽可能详细，包含参数、示例、返回值和常见错误。

- **检索/调用**:
    - 在选择或使用任何工具之前，必须查阅此文件以了解其最准确的用法。
    - 当工具执行出错时，应首先查阅此文件中的常见错误和解决方案。

#### c. 推荐格式

```markdown
## `[工具名称]`

**功能**: [该工具的核心功能描述]

**参数**:
| 参数名 | 类型 | 是否必需 | 描述 |
|---|---|---|---|
| `param1` | `string` | 是 | [参数1的详细说明] |
| `param2` | `boolean` | 否 | [参数2的详细说明] |

**用法示例**:

* **基本用法**:
  ```python
  # 一个清晰的、可直接运行的示例
  tool.function(param1='value')
  ```
* **高级用法**:
  ```python
  # 展示更复杂或不常见的用法
  tool.function(param1='value', param2=True)
  ```

**注意事项/限制**:
- [使用该工具时需要特别注意的地方]
- [该工具已知的局限性或常见问题]
```
